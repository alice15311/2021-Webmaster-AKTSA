<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Explore</title>
    <link rel = "icon" href = "../favicon.ico"/>
    <link href="../style.css" rel="stylesheet" type="text/css"/>
    <link href="accountPageStyle.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <!--navigation bar-->
    <nav class = "navbar account-topNav scrolledDown">
      <!--company name to display on mobile outside of menu-->
      <span class = "navName nav-backup"><a href = "../index.html">KatKure</a></span>
      
      <!--links-->
      <div class = "navbar-collapse">
        <ul>
          <li><span class = "navName"><a href = "../index.html">KatKure</a></span></li>
          <li><a href = "../index.html">Home</a></li>
          <li><a class = "dropdown-top">About</a>
            <div>
              <ul class = "dropdown">
                <li><a href = "../about.html">Company</a></li>
                <li><a href = "../about-webpage.html">This page</a></li>
              </ul>
            </div>
          </li>
          <li><a class = "dropdown-top">Products</a>
            <div>
              <ul class = "dropdown">
                <li><a href = "../services.html">Platform</a></li>
                <li><a href = "../products.html">Shop</a></li>
                <li><a href = "../cart.html">Cart</a></li>
              </ul>
            </div>
          </li>
          <li><a href = "../news/index.html">News</a></li>
          <li><a href = "../faq.html">FAQs</a></li>
          <li class = "accountLink"><a class = "dropdown-top loggedIn"><i class = "material-icons">account_circle</i>Jane Doe</a>
            <div>
              <ul class = "dropdown">
                <li class = "nav-active"><a href = "dashboard.html">Dashboard</a></li>
                <li><a href = "../index.html">Log Out</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </div>

      <!--menu icon for mobile display-->
      <i class = "material-icons" id = "navMenu">menu</i>
    </nav>

    <!--side nav with account navigation-->
    <nav class = "sidebar">
      <ul>
        <li><a href = "dashboard.html"><i class = "material-icons">space_dashboard</i><span>Dashboard</span></a></li>
        <li><a href = "appointments.html"><i class = "material-icons">date_range</i><span>Appointments</span></a></li>
        <li><a href = "conversations.html"><i class = "material-icons">question_answer</i><span>Conversations</span></a></li>
        <li class = "nav-active"><a href = "explore.html"><i class = "material-icons">explore</i><span>Explore</span></a></li>
        <li><a href = "settings.html"><i class = "material-icons">manage_accounts</i><span>Account</span></a></li>
        <li><a class = "log-out-button"><i class = "material-icons">logout</i><span>Log out</span></a></li>
      </ul>
    </nav>

    <div class = "account-content">
      <div class = "pageHeading">
        <h1>Explore</h1>
      </div>

      <!--search form-->
      <div id = "exploreSearchForm">
        <div>
          <input type = "text" placeholder = "Search" id = "exploreSearch"/>
          <i class = "material-icons">search</i>
        </div>
        <div>
          <div>
            <span id = "exploreFilter">Filters: </span>
            <!--filtering doctors-->
            <div class = "filter-container">
              <!--license type-->
              <div class = "filter" data-for = "license">
                <span class = "filter-title">License</span>
                <form>
                  <div class = "checkLi">
                    <label for = "LMHC">LMHC
                      <input type = "checkbox" id = "LMHC" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "LPC">LPC
                      <input type = "checkbox" id = "LPC" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "LCSW">LCSW
                      <input type = "checkbox" id = "LCSW" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "PsyD">PsyD
                      <input type = "checkbox" id = "PsyD" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                </form>
              </div>
              <!--focus of doctor-->
              <div class = "filter" style = "min-width: 10em" data-for = "focus">
                <span class = "filter-title">Focus</span>
                <form>
                  <div class = "checkLi">
                    <label for = "subAbuse">Substance abuse
                      <input type = "checkbox" id = "subAbuse" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "recovery">Recovery
                      <input type = "checkbox" id = "recovery" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "moodDis">Mood disorders
                      <input type = "checkbox" id = "moodDis" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "anxietyDis">Anxiety disorders
                      <input type = "checkbox" id = "anxietyDis" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "personDis">Personality disorders
                      <input type = "checkbox" id = "personDis" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                </form>
              </div>
            </div>
            <!--filtering groups-->
            <div class = "filter-container">
              <!--focus-->
              <div class = "filter" style = "min-width: 10em" data-for = "focus">
                <span class = "filter-title">Focus</span>
                <form>
                  <div class = "checkLi">
                    <label for = "subAbuseG">Substance abuse
                      <input type = "checkbox" id = "subAbuseG" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "depression">Depression
                      <input type = "checkbox" id = "depression" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "anxiety">Anxiety
                      <input type = "checkbox" id = "anxiety" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "selfImprov">Self-Improvement
                      <input type = "checkbox" id = "selfImprov" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                </form>
              </div>
              <!--meeting frequency-->
              <div class = "filter" style = "min-width: 11em" data-for = "meeting">
                <span class = "filter-title">Meetings</span>
                <form>
                  <label>Meeting Frequency</label>
                  <div class = "checkLi">
                    <label for = "weekly">Weekly
                      <input type = "checkbox" id = "weekly" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "biweekly">Biweekly
                      <input type = "checkbox" id = "biweekly" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <label>Meeting Length</label>
                  <div class = "checkLi">
                    <label for = "45min">45 minutes
                      <input type = "checkbox" id = "45min" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "1hr">1 hour
                      <input type = "checkbox" id = "1hr" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "1-halfhr">1.5 hours
                      <input type = "checkbox" id = "1-halfhr" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "2hr">2 hours
                      <input type = "checkbox" id = "2hr" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                </form>
              </div>
              <!--open/closed group-->
              <div class = "filter" data-for = "closed">
                <span class = "filter-title">Type</span>
                <form>
                  <div class = "checkLi">
                    <label for = "openGroup">Open
                      <input type = "checkbox" id = "openGroup" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                  <div class = "checkLi">
                    <label for = "closedGroup">Closed
                      <input type = "checkbox" id = "closedGroup" checked>
                      <div class = "checkbox"></div>
                    </label>
                  </div>
                </form>
              </div>
              <!--group size-->
              <div id = "groupSize" data-for = "size">
                <span class = "filter-title">Size: </span>
                <form>
                  <input type = "number" min = "5" max = "15" id = "groupMin" value = "5"/>
                  <label for = "groupMax">to</label>
                  <input type = "number" min = "5" max = "15" id = "groupMax" value = "15"/>
                </form>
              </div>
            </div>
            <button id = "exploreGo" class = "accountButton">Search</button>
          </div>
        </div>
      </div>

      <!--content-->
      <div id = "exploreContent">
        <!--tabs-->
        <div id = "exploreTabs">
          <div class = "active">
            <i class = "material-icons">star</i>
            <p>Recommended</p>
          </div>
          <div>
            <i class = "material-icons">person</i>
            <p>Counselors</p>
          </div>
          <div>
            <i class = "material-icons">groups</i>
            <p>Groups</p>
          </div>
          <div>
            <i class = "material-icons">celebration</i>
            <p>Events</p>
          </div>
        </div>

        <!--recommended-->
        <div class = "explorePage"></div>

        <!--counselors-->
        <div class = "explorePage"></div>

        <!--groups-->
        <div class = "explorePage"></div>

        <!--events-->
        <div class = "explorePage"></div>

        <!--no search results-->
        <div id = "noSearchResults">
          <h2>Sorry, there doesn't seem to be any search results for this</h2>
          <p>Please try searching for something else</p>
        </div>
      </div>

      <!--alerts-->
      <div id = "alerts"></div>

      <!--footer-->
      <footer class = "footer account-footer">
        <div class = "footer-text">Copyright KatKure 2021 <i class = "material-icons">copyright</i></div>
      </footer>
    </div>
    <script src = "../script.js"></script>
    <script src = "eventTimes.js"></script>
    <script src = "exploreData.js"></script>
    <script>
      //setting up filters' dropdowns
      const filters = document.getElementsByClassName("filter");
      let createFilterDropFunc = function(ind){
        const target = filters[ind].getElementsByTagName("form")[0];
        const parentEl = filters[ind];
        let clicks = 0;
        function handleTransitionEnd(){
          target.style.display = "none";
          target.removeEventListener("transitionend", handleTransitionEnd);
        }
        return function(){
          clicks++;
          if(clicks % 2 === 1){
            target.style.display = "block";
            window.setTimeout(function(){
              target.style.opacity = "1";
            }, 1);
          }
          else {
            target.style.opacity = "0";
            target.addEventListener("transitionend", handleTransitionEnd);
          }
          parentEl.classList.toggle("active");
        }
      }
      for(let i = 0; i < filters.length; i++){
        let filterDrop = filters[i].getElementsByClassName("filter-title")[0];
        let clickFunc = createFilterDropFunc(i);
        filterDrop.addEventListener("click", clickFunc);
      }

      //getting signed up data, if any
      let hasReqData = localStorage.getItem("accountReq") !== null;
      let reqData = hasReqData ? JSON.parse(localStorage.getItem("accountReq")):{ counselors: {}, groups: [], events: [] };
      function saveReqs(){
        localStorage.setItem("accountReq", JSON.stringify(reqData));
      }

      //creating page content based on data
      const explorePages = document.getElementsByClassName("explorePage");
      function createCounselorDiv(obj, requested, ind){
        let newDiv = document.createElement("div");
        newDiv.className = "listing counselor" + (obj.recommended ? " recommended":"");
        newDiv.dataset.index = ind;
        let divContent = "<img src = \"" + obj.img + "\"/>" +
          "<div class = \"counselor-description\">" +
            "<p>" + obj.name + "</p>" +
            "<p>License: " + obj.license + "</p>" +
            (obj.recommended ? "<p class = \"recommended\">Recommended</p>":"") +
            "<p>" + obj.description + "</p>" +
            "<div class = \"buttons\">" +
              "<button class = \"sendRequest accountButton" + (requested ? " grayedout":"") + "\" data-for = \"" + ind + "\">" + (requested ? "Sent":"Send request") + "</button>" +
            "</div>" +
          "</div>"
        newDiv.innerHTML = divContent;
        explorePages[1].appendChild(newDiv);
        if(obj.recommended){
          let copy = newDiv.cloneNode(true);
          explorePages[0].appendChild(copy);
        }
      };
      function createGroupDiv(obj, requested, ind){
        let newDiv = document.createElement("div");
        newDiv.className = "listing group" + (obj.recommended ? " recommended":"");
        newDiv.dataset.index = ind;
        let counselor = counselors[obj.leader];
        let focusDiv = "";
        for(let i = 0; i < obj.focus.length; i++){
          focusDiv += "<p class = \"focus\">" + obj.focus[i] + "</p>";
        }
        let divContent = "<div class = \"group-description\">" +
            "<p>" + obj.name + "</p>" +
            "<p>Led by " + counselor.name + ", " + counselor.license + "</p>" +
            (obj.recommended ? "<p class = \"recommended\">Recommended</p>":"") +
            "<div class = \"group-info\">" +
              "<div>" +
                "<p><i class = \"material-icons\">calendar_today</i>Meets " + (obj.meetWeekly ? "weekly":"biweekly") + " " + obj.meetDay + " from " + obj.meetTime + "</p>" +
                "<p><i class = \"material-icons\">lock_open</i>" + (obj.closed ? "Closed":"Open") + " group</p>" +
                "<p><i class = \"material-icons\">people</i>" + obj.size + " people</p>" +
              "</div>" +
              "<div class = \"group-focus\"><p>Focus:</p>" + focusDiv + "</div>" +
            "</div>" +
            "<p>" + obj.description + "</p>" +
          "</div>" +
          "<div class = \"buttons\">" +
            "<button class = \"sendGroupRequest accountButton " + (requested || obj.closed ? "grayedout":"") + "\" data-for = \"" + ind + "\">" + (requested ? "Sent":"Join") + "</button>" +
          "</div>";
        newDiv.innerHTML = divContent;
        explorePages[2].appendChild(newDiv);
        if(obj.recommended){
          let copy = newDiv.cloneNode(true);
          explorePages[0].appendChild(copy);
        }
      }
      function createEventDiv(obj, signedUp, ind){
        let newDiv = document.createElement("div");
        newDiv.className = "listing event";
        let newDate = addDays(curTime, parseFloat(obj.date));
        let divContent = "<div class = \"imgWrapper\">" +
            "<img src = \"" + obj.img + "\">" +
          "</div>" +
          "<div class = \"event-description\">" +
            "<p>" + obj.title + "</p>" +
            "<p>" + obj.leader + "</p>" +
            "<p class = \"event-date\"><i class = \"material-icons\">calendar_today</i>" + createFullMonthStr(newDate) + "<span class = \"event-time\">" + obj.time + "</p>" +
            "<p>" + obj.description + "</p>" +
            "<button class = \"signUpEvent accountButton" + (signedUp ? " grayedout":"") + "\" data-for = \"" + ind + "\">" + (signedUp ? "Signed up":"Sign Up") + "</button>" +
          "</div>"
        newDiv.innerHTML = divContent;
        explorePages[3].appendChild(newDiv);
      }
      for(i in counselors){
        //setting up req data if not already done
        if(!hasReqData){
          reqData.counselors[i] = counselors[i].sent === true;
        }
        createCounselorDiv(counselors[i], reqData.counselors[i], i);
      }
      for(let i = 0; i < groups.length; i++){
        //setting up req data if not already done
        if(!hasReqData){
          reqData.groups[i] = groups[i].sent === true;
        }
        createGroupDiv(groups[i], reqData.groups[i], i);
      }
      for(let i = 0; i < events.length; i++){
        //setting up req data if not already done
        if(!hasReqData){
          reqData.events[i] = i === 0;
        }
        createEventDiv(events[i], reqData.events[i], i);
      }
      if(!hasReqData){
        saveReqs();
      }

      //setting up appointments if they haven't already, to anticipate signing up for events
      const hasAppt = localStorage.getItem("accountAppt") !== null;
      let appointments = hasAppt ? JSON.parse(localStorage.getItem("accountAppt")):[];
      function saveAppts(){
        localStorage.setItem("accountAppt", JSON.stringify(appointments));
      }
      if(!hasAppt){
        //create appointment object function
        function createAppt(date, type, options){
          let appt = {};
          appt.date = date.toString();
          if(type === "counselor"){
            appt.person = "Alina Miller";
            appt.personCred = "Counselor, LMHC";
            appt.time = "2:00 - 3:00 PM";
            appt.title = "Individual session";
            appt.descrip = "Weekly counseling meeting";
          }
          else if(type === "group"){
            appt.person = "Hazel Jones";
            appt.personCred = "Leader, LMHC";
            appt.time = "9:00 - 10:00 AM";
            appt.title = "Group session";
            appt.descrip = "Weekly session with a closed group";
          }
          else {
            appt.person = options.person;
            appt.personCred = "Speaker";
            appt.time = options.time;
            appt.title = options.title;
            appt.descrip = options.descrip;
            appt.eventIndex = options.index;
          }
          appt.type = type;
          return appt;
        }

        //creating objects
        for(let i = 0; i < 3; i++){
          appointments.push(createAppt(1 + i * 7, "group"));
          appointments.push(createAppt(3 + i * 7, "counselor"));
        }

        //creating event that we're signed up for
        appointments.push(createAppt(5, "event", { person: "Taylor Peterson", time: "10:00 - 10:45 AM", title: "How to Meditate", descrip: "A talk on the basics of meditation", index: 0 }));

        //sorting in terms of closest to furthest away in date
        appointments.sort(function(a, b){
          return a.date - b.date;
        });

        //save this
        saveAppts();
      }

      //adding event listeners to send request/sign up buttons
      const reqButtons = document.getElementsByClassName("sendRequest");
      const groupReqButtons = document.getElementsByClassName("sendGroupRequest");
      const eventSignUpButtons = document.getElementsByClassName("signUpEvent");
      const alertDiv = document.getElementById("alerts");
      function createAlert(message){
        //creating div
        let newDiv = document.createElement("div");
        newDiv.className = "explore-alert";
        newDiv.innerHTML = "<i class = \"material-icons\">check_circle_outline</i><p>" + message + "</p>";
        let closeButton = document.createElement("span");
        closeButton.className = "close-alert";
        closeButton.innerHTML = "<i class = \"material-icons\">close</i>"
        newDiv.appendChild(closeButton);
        alertDiv.appendChild(newDiv);

        //adding fade in animation (and automatically fading out if left alone)
        window.setTimeout(function(){
          newDiv.style.opacity = "1";
          newDiv.addEventListener("transitionend", function(){
            //fading out after 4 seconds of staying there
            window.setTimeout(function(){
              newDiv.style.opacity = "0";
              newDiv.addEventListener("transitionend", function(){
                alertDiv.removeChild(newDiv);
              });
            }, 4000);
          });
        }, 1);

        //adding event listener to close it
        closeButton.addEventListener("click", function(){
          newDiv.style.opacity = "0";
          newDiv.addEventListener("transitionend", function(){
            alertDiv.removeChild(newDiv);
          });
        });
      }
      function createEventAppt(event, index){
        appointments.push({
          date: event.date,
          person: event.leader,
          personCred: "Speaker",
          time: event.time,
          title: event.title,
          descrip: event.shortDescrip,
          eventIndex: index,
          type: "event"
        });
        saveAppts();
      }
      let createReqClickFunc = function(el, isCounselor, ind){
        let buttonEl = el;
        let index = ind;
        let target = isCounselor ? reqData.counselors:reqData.groups;
        return function(){
          target[ind] = true;
          buttonEl.className += " grayedout";
          buttonEl.textContent = "Sent";
          saveReqs();
          createAlert("Request successfully sent!");
        }
      }
      let createSignUpClickFunc = function(el, ind){
        let buttonEl = el;
        let index = ind;
        let event = events[parseFloat(ind)];
        return function(){
          reqData.events[index] = true;
          buttonEl.className += " grayedout";
          buttonEl.textContent = "Signed up";
          saveReqs();
          createEventAppt(event, index);
          createAlert("Successfully signed up!");
        }
      }
      for(let i = 0; i < reqButtons.length; i++){
        let clickFunc = createReqClickFunc(reqButtons[i], true, reqButtons[i].dataset.for);
        reqButtons[i].addEventListener("click", clickFunc);
      }
      for(let i = 0; i < groupReqButtons.length; i++){
        let clickFunc = createReqClickFunc(groupReqButtons[i], false, groupReqButtons[i].dataset.for);
        groupReqButtons[i].addEventListener("click", clickFunc);
      }
      for(let i = 0; i < eventSignUpButtons.length; i++){
        let clickFunc = createSignUpClickFunc(eventSignUpButtons[i], eventSignUpButtons[i].dataset.for);
        eventSignUpButtons[i].addEventListener("click", clickFunc);
      }

      //setting up explore page changing
      const exploreTabs = document.getElementById("exploreTabs").getElementsByTagName("div");
      const filterSpanText = document.getElementById("exploreFilter");
      const filterConts = document.getElementsByClassName("filter-container");
      let curPage = 0;
      let prevPage = 0;
      let createTabClickFunc = function(ind){
        const tabTarg = exploreTabs[ind];
        const filterTarg = (ind === 1 || ind === 2) ? filterConts[ind - 1]:null;
        const pageTarg = explorePages[ind];
        const index = ind;
        return function(){
          //updating previous and current pages
          prevPage = curPage;
          explorePages[prevPage].style.display = "none";
          curPage = index;
          pageTarg.style.display = "block";
          
          //updating explore tabs
          exploreTabs[prevPage].className = "";
          tabTarg.className = "active";

          //updating filters
          for(var i = 0; i < filterConts.length; i++){
            filterConts[i].style.display = "none";
          }
          if(filterTarg === null){
            filterSpanText.style.display = "none";
          }
          else {
            filterTarg.style.display = "inline";
            filterSpanText.style.display = "inline";
          }
        }
      }
      for(let i = 0; i < exploreTabs.length; i++){
        let clickFunc = createTabClickFunc(i);
        exploreTabs[i].addEventListener("click", clickFunc);
      }
      //initial setup of hiding all pages except current one
      for(let i = 0; i < explorePages.length; i++){
        if(curPage !== i){
          explorePages[i].style.display = "none";
        }
        if(i < filterConts.length){
          filterConts[i].style.display = "none";
        }
      }
      filterSpanText.style.display = "none";

      //setting up search + filtering
      const searchGo = document.getElementById("exploreGo");
      let handleSearch = (function(){
        //search bar stuff
        const searchBar = document.getElementById("exploreSearch");
        function applySearch(div){
          if(div.textContent.toLowerCase().indexOf(searchBar.value) === -1){
            div.dataset.hide = "true";
          }
        }
        const noResultsDiv = document.getElementById("noSearchResults");

        //function to filter based on a function
        function checkFilter(curEl, curObj, filtersForm, checkFunc){
          //skip if it's already hidden
          if(curEl.dataset.hide === "true"){
            return;
          }

          //otherwise, apply filters
          let checkList = filtersForm.getElementsByTagName("input");
          let show = checkFunc(curObj, checkList, curEl);

          //check if it should be hidden or not
          if(!show) {
            curEl.dataset.hide = "true";
          }
        }
        let meetTimes = [0.75, 1, 1.5, 2]; //for filtering by groups meeting times

        //actual function on click
        return function(){
          let curPageEl = explorePages[curPage];
          let allDivs = curPageEl.getElementsByClassName("listing");

          //setting up filtering
          let filterDiv = (curPage === 1 || curPage === 2) ? filterConts[curPage - 1]:null;
          let filters = filterDiv ? filterDiv.getElementsByClassName("filter"):null;

          //no results or not
          let noResults = true;

          //handling counselors
          if(curPage === 1){
            for(let i = 0; i < allDivs.length; i++){
              let curEl = allDivs[i];
              let curObj = counselors[Object.keys(counselors)[i]];
              curEl.dataset.hide = "false";

              //use search terms
              applySearch(curEl);

              //checking license
              checkFilter(curEl, curObj, filters[0].getElementsByTagName("form")[0], function(curObj, checkList){
                return document.getElementById(curObj.license).checked;
              });

              //checking focus
              checkFilter(curEl, curObj, filters[1].getElementsByTagName("form")[0], function(curObj, checkList){
                //loop through focus, and then loop through list of possible focuses - if one is checked and matches the focus text, include this group
                for(let j = 0; j < curObj.focus.length; j++){
                  for(let k = 0; k < checkList.length; k++){
                    let focus = checkList[k].parentElement.innerText.toLowerCase();
                    focus = focus.split(/[\n\r ]/g).join("");
                    console.log(focus === curObj.focus[j].toLowerCase().split(" ").join(""))
                    if(checkList[k].checked && focus === curObj.focus[j].toLowerCase().split(" ").join("")){
                      return true;
                    }
                  }
                }
                return false;
              });

              //hiding or not hiding based on the dataset
              if(curEl.dataset.hide === "true"){
                curEl.style.display = "none";
              }
              else {
                curEl.style.display = "flex";
                noResults = false;
              }
            }
          }
          
          //handling groups
          else if(curPage === 2){
            for(let i = 0; i < allDivs.length; i++){
              let curEl = allDivs[i];
              let curObj = groups[parseFloat(curEl.dataset.index)];
              curEl.dataset.hide = "false";

              //use search terms
              applySearch(curEl);

              //checking focus
              checkFilter(curEl, curObj, filters[0].getElementsByTagName("form")[0], function(curObj, checkList){
                //loop through focus, and then loop through list of possible focuses - if one is checked and matches the focus text, include this group
                for(let j = 0; j < curObj.focus.length; j++){
                  for(let k = 0; k < checkList.length; k++){
                    let focus = checkList[k].parentElement.innerText.toLowerCase();
                    focus = focus.split(/[\n\r ]/g).join("");
                    if(checkList[k].checked && focus === curObj.focus[j].toLowerCase().split(" ").join("")){
                      return true;
                    }
                  }
                }
                return false;
              });

              //checking meetings
              checkFilter(curEl, curObj, filters[1].getElementsByTagName("form")[0], function(curObj, checkList){
                //meeting weekly/biweekly check
                if(curObj.meetWeekly && !checkList[0].checked){
                  return false;
                }
                else if(!curObj.meetWeekly && !checkList[1].checked){
                  return false;
                }

                //meeting length check
                if(!checkList[meetTimes.indexOf(curObj.meetLength) + 2].checked){
                  return false;
                }
                return true;
              });

              //checking type
              checkFilter(curEl, curObj, filters[2].getElementsByTagName("form")[0], function(curObj, checkList){
                //if open, first option must be checked
                if(!curObj.closed && !checkList[0].checked){
                  return false;
                }
                //if closed, second option must be checked
                else if(curObj.closed && !checkList[1].checked){
                  return false;
                }
                return true;
              });

              //checking size
              checkFilter(curEl, curObj, document.getElementById("groupSize"), function(curObj, checkList, curEl){
                if(curObj.size >= parseFloat(checkList[0].value) && curObj.size <= parseFloat(checkList[1].value)){
                  return true;
                }
                return false;
              });

              //hiding or not hiding based on the dataset
              if(curEl.dataset.hide === "true"){
                curEl.style.display = "none";
              }
              else {
                curEl.style.display = "flex";
                noResults = false;
              }
            }
          }

          //handling everything else
          else {
            for(let i = 0; i < allDivs.length; i++){
              let curEl = allDivs[i];
              curEl.dataset.hide = "false";
              applySearch(curEl);
              if(curEl.dataset.hide === "true"){
                curEl.style.display = "none";
              }
              else {
                curEl.style.display = "flex";
                noResults = false;
              }
            }
          }

          //handling no results
          if(noResults){
            noResultsDiv.style.display = "block";
          }
          else {
            noResultsDiv.style.display = "none";
          }
        }
      })();
      searchGo.addEventListener("click", handleSearch);
    </script>
  </body>
</html>